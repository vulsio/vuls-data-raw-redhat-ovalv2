{
	"id": "oval:com.redhat.cve:def:202147099",
	"version": "636",
	"class": "vulnerability",
	"metadata": {
		"title": "kernel: veth: ensure skb entering GRO are not cloned. (moderate)",
		"reference": [
			{
				"ref_id": "CVE-2021-47099",
				"ref_url": "https://access.redhat.com/security/cve/CVE-2021-47099",
				"source": "CVE"
			}
		],
		"description": "DOCUMENTATION: The MITRE CVE dictionary describes this issue as: In the Linux kernel, the following vulnerability has been resolved:\n\nveth: ensure skb entering GRO are not cloned.\n\nAfter commit d3256efd8e8b (\"veth: allow enabling NAPI even without XDP\"),\nif GRO is enabled on a veth device and TSO is disabled on the peer\ndevice, TCP skbs will go through the NAPI callback. If there is no XDP\nprogram attached, the veth code does not perform any share check, and\nshared/cloned skbs could enter the GRO engine.\n\nIgnat reported a BUG triggered later-on due to the above condition:\n\n[   53.970529][    C1] kernel BUG at net/core/skbuff.c:3574!\n[   53.981755][    C1] invalid opcode: 0000 [#1] PREEMPT SMP KASAN PTI\n[   53.982634][    C1] CPU: 1 PID: 19 Comm: ksoftirqd/1 Not tainted 5.16.0-rc5+ #25\n[   53.982634][    C1] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015\n[   53.982634][    C1] RIP: 0010:skb_shift+0x13ef/0x23b0\n[   53.982634][    C1] Code: ea 03 0f b6 04 02 48 89 fa 83 e2 07 38 d0\n7f 08 84 c0 0f 85 41 0c 00 00 41 80 7f 02 00 4d 8d b5 d0 00 00 00 0f\n85 74 f5 ff ff <0f> 0b 4d 8d 77 20 be 04 00 00 00 4c 89 44 24 78 4c 89\nf7 4c 89 8c\n[   53.982634][    C1] RSP: 0018:ffff8881008f7008 EFLAGS: 00010246\n[   53.982634][    C1] RAX: 0000000000000000 RBX: ffff8881180b4c80 RCX: 0000000000000000\n[   53.982634][    C1] RDX: 0000000000000002 RSI: ffff8881180b4d3c RDI: ffff88810bc9cac2\n[   53.982634][    C1] RBP: ffff8881008f70b8 R08: ffff8881180b4cf4 R09: ffff8881180b4cf0\n[   53.982634][    C1] R10: ffffed1022999e5c R11: 0000000000000002 R12: 0000000000000590\n[   53.982634][    C1] R13: ffff88810f940c80 R14: ffff88810f940d50 R15: ffff88810bc9cac0\n[   53.982634][    C1] FS:  0000000000000000(0000) GS:ffff888235880000(0000) knlGS:0000000000000000\n[   53.982634][    C1] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[   53.982634][    C1] CR2: 00007ff5f9b86680 CR3: 0000000108ce8004 CR4: 0000000000170ee0\n[   53.982634][    C1] Call Trace:\n[   53.982634][    C1]  <TASK>\n[   53.982634][    C1]  tcp_sacktag_walk+0xaba/0x18e0\n[   53.982634][    C1]  tcp_sacktag_write_queue+0xe7b/0x3460\n[   53.982634][    C1]  tcp_ack+0x2666/0x54b0\n[   53.982634][    C1]  tcp_rcv_established+0x4d9/0x20f0\n[   53.982634][    C1]  tcp_v4_do_rcv+0x551/0x810\n[   53.982634][    C1]  tcp_v4_rcv+0x22ed/0x2ed0\n[   53.982634][    C1]  ip_protocol_deliver_rcu+0x96/0xaf0\n[   53.982634][    C1]  ip_local_deliver_finish+0x1e0/0x2f0\n[   53.982634][    C1]  ip_sublist_rcv_finish+0x211/0x440\n[   53.982634][    C1]  ip_list_rcv_finish.constprop.0+0x424/0x660\n[   53.982634][    C1]  ip_list_rcv+0x2c8/0x410\n[   53.982634][    C1]  __netif_receive_skb_list_core+0x65c/0x910\n[   53.982634][    C1]  netif_receive_skb_list_internal+0x5f9/0xcb0\n[   53.982634][    C1]  napi_complete_done+0x188/0x6e0\n[   53.982634][    C1]  gro_cell_poll+0x10c/0x1d0\n[   53.982634][    C1]  __napi_poll+0xa1/0x530\n[   53.982634][    C1]  net_rx_action+0x567/0x1270\n[   53.982634][    C1]  __do_softirq+0x28a/0x9ba\n[   53.982634][    C1]  run_ksoftirqd+0x32/0x60\n[   53.982634][    C1]  smpboot_thread_fn+0x559/0x8c0\n[   53.982634][    C1]  kthread+0x3b9/0x490\n[   53.982634][    C1]  ret_from_fork+0x22/0x30\n[   53.982634][    C1]  </TASK>\n\nAddress the issue by skipping the GRO stage for shared or cloned skbs.\nTo reduce the chance of OoO, try to unclone the skbs before giving up.\n\nv1 -> v2:\n - use avoid skb_copy and fallback to netif_receive_skb  - Eric",
		"advisory": {
			"from": "secalert@redhat.com",
			"severity": "Moderate",
			"updated": {
				"date": "2024-04-16"
			},
			"cve": [
				{
					"text": "CVE-2021-47099",
					"cvss3": "6.0/CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:H",
					"cwe": "CWE-20",
					"href": "https://access.redhat.com/security/cve/CVE-2021-47099",
					"impact": "moderate",
					"public": "20240304"
				}
			],
			"affected": {
				"resolution": [
					{
						"state": "Out of support scope",
						"component": [
							"bpftool",
							"kernel",
							"kernel-abi-whitelists",
							"kernel-bootwrapper",
							"kernel-debug",
							"kernel-debug-devel",
							"kernel-devel",
							"kernel-doc",
							"kernel-headers",
							"kernel-kdump",
							"kernel-kdump-devel",
							"kernel-rt",
							"kernel-rt-debug",
							"kernel-rt-debug-devel",
							"kernel-rt-debug-kvm",
							"kernel-rt-devel",
							"kernel-rt-doc",
							"kernel-rt-kvm",
							"kernel-rt-trace",
							"kernel-rt-trace-devel",
							"kernel-rt-trace-kvm",
							"kernel-tools",
							"kernel-tools-libs",
							"kernel-tools-libs-devel",
							"perf",
							"python-perf"
						]
					}
				]
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/a:redhat:rhel_extras:7",
					"cpe:/a:redhat:rhel_extras_oracle_java:7",
					"cpe:/a:redhat:rhel_extras_rt:7",
					"cpe:/a:redhat:rhel_extras_sap:7",
					"cpe:/a:redhat:rhel_extras_sap_hana:7",
					"cpe:/o:redhat:enterprise_linux:7",
					"cpe:/o:redhat:enterprise_linux:7::client",
					"cpe:/o:redhat:enterprise_linux:7::computenode",
					"cpe:/o:redhat:enterprise_linux:7::server",
					"cpe:/o:redhat:enterprise_linux:7::workstation"
				]
			},
			"issued": {}
		},
		"affected": {}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterias": [
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446031",
										"comment": "kernel-rt-trace-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446032",
										"comment": "kernel-rt-trace-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446045",
										"comment": "kernel-rt-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446046",
										"comment": "kernel-rt-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446027",
										"comment": "kernel-rt is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446028",
										"comment": "kernel-rt is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542001",
										"comment": "kernel-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542002",
										"comment": "kernel-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542019",
										"comment": "kernel-kdump-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542020",
										"comment": "kernel-kdump-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542003",
										"comment": "kernel-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542004",
										"comment": "kernel-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542009",
										"comment": "bpftool is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542010",
										"comment": "bpftool is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542005",
										"comment": "kernel-doc is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542006",
										"comment": "kernel-doc is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446043",
										"comment": "kernel-rt-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446044",
										"comment": "kernel-rt-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542029",
										"comment": "kernel-tools-libs is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542030",
										"comment": "kernel-tools-libs is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446009",
										"comment": "kernel-rt-debug-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446010",
										"comment": "kernel-rt-debug-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542021",
										"comment": "python-perf is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542022",
										"comment": "python-perf is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542031",
										"comment": "kernel-headers is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542032",
										"comment": "kernel-headers is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542007",
										"comment": "kernel-kdump is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542008",
										"comment": "kernel-kdump is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446051",
										"comment": "kernel-rt-trace is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446052",
										"comment": "kernel-rt-trace is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446021",
										"comment": "kernel-rt-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446022",
										"comment": "kernel-rt-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542013",
										"comment": "kernel-bootwrapper is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542014",
										"comment": "kernel-bootwrapper is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542023",
										"comment": "kernel-abi-whitelists is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542024",
										"comment": "kernel-abi-whitelists is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542011",
										"comment": "perf is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542012",
										"comment": "perf is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542025",
										"comment": "kernel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542026",
										"comment": "kernel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446017",
										"comment": "kernel-rt-trace-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446018",
										"comment": "kernel-rt-trace-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446001",
										"comment": "kernel-rt-doc is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446002",
										"comment": "kernel-rt-doc is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542017",
										"comment": "kernel-tools-libs-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542018",
										"comment": "kernel-tools-libs-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446015",
										"comment": "kernel-rt-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446016",
										"comment": "kernel-rt-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542015",
										"comment": "kernel-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542016",
										"comment": "kernel-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542027",
										"comment": "kernel-tools is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542028",
										"comment": "kernel-tools is signed with Red Hat redhatrelease2 key"
									}
								]
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:com.redhat.cve:tst:20042779005",
						"comment": "Red Hat Enterprise Linux 7 is installed"
					}
				]
			}
		],
		"criterions": [
			{
				"test_ref": "oval:com.redhat.cve:tst:20042779006",
				"comment": "Red Hat Enterprise Linux must be installed"
			}
		]
	}
}
