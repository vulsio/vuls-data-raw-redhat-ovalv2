{
	"id": "oval:com.redhat.cve:def:202147563",
	"version": "636",
	"class": "vulnerability",
	"metadata": {
		"title": "kernel: ice: avoid bpf_prog refcount underflow (moderate)",
		"reference": [
			{
				"ref_id": "CVE-2021-47563",
				"ref_url": "https://access.redhat.com/security/cve/CVE-2021-47563",
				"source": "CVE"
			}
		],
		"description": "DOCUMENTATION: The MITRE CVE dictionary describes this issue as: In the Linux kernel, the following vulnerability has been resolved:\n\nice: avoid bpf_prog refcount underflow\n\nIce driver has the routines for managing XDP resources that are shared\nbetween ndo_bpf op and VSI rebuild flow. The latter takes place for\nexample when user changes queue count on an interface via ethtool's\nset_channels().\n\nThere is an issue around the bpf_prog refcounting when VSI is being\nrebuilt - since ice_prepare_xdp_rings() is called with vsi->xdp_prog as\nan argument that is used later on by ice_vsi_assign_bpf_prog(), same\nbpf_prog pointers are swapped with each other. Then it is also\ninterpreted as an 'old_prog' which in turn causes us to call\nbpf_prog_put on it that will decrement its refcount.\n\nBelow splat can be interpreted in a way that due to zero refcount of a\nbpf_prog it is wiped out from the system while kernel still tries to\nrefer to it:\n\n[  481.069429] BUG: unable to handle page fault for address: ffffc9000640f038\n[  481.077390] #PF: supervisor read access in kernel mode\n[  481.083335] #PF: error_code(0x0000) - not-present page\n[  481.089276] PGD 100000067 P4D 100000067 PUD 1001cb067 PMD 106d2b067 PTE 0\n[  481.097141] Oops: 0000 [#1] PREEMPT SMP PTI\n[  481.101980] CPU: 12 PID: 3339 Comm: sudo Tainted: G           OE     5.15.0-rc5+ #1\n[  481.110840] Hardware name: Intel Corp. GRANTLEY/GRANTLEY, BIOS GRRFCRB1.86B.0276.D07.1605190235 05/19/2016\n[  481.122021] RIP: 0010:dev_xdp_prog_id+0x25/0x40\n[  481.127265] Code: 80 00 00 00 00 0f 1f 44 00 00 89 f6 48 c1 e6 04 48 01 fe 48 8b 86 98 08 00 00 48 85 c0 74 13 48 8b 50 18 31 c0 48 85 d2 74 07 <48> 8b 42 38 8b 40 20 c3 48 8b 96 90 08 00 00 eb e8 66 2e 0f 1f 84\n[  481.148991] RSP: 0018:ffffc90007b63868 EFLAGS: 00010286\n[  481.155034] RAX: 0000000000000000 RBX: ffff889080824000 RCX: 0000000000000000\n[  481.163278] RDX: ffffc9000640f000 RSI: ffff889080824010 RDI: ffff889080824000\n[  481.171527] RBP: ffff888107af7d00 R08: 0000000000000000 R09: ffff88810db5f6e0\n[  481.179776] R10: 0000000000000000 R11: ffff8890885b9988 R12: ffff88810db5f4bc\n[  481.188026] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000\n[  481.196276] FS:  00007f5466d5bec0(0000) GS:ffff88903fb00000(0000) knlGS:0000000000000000\n[  481.205633] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[  481.212279] CR2: ffffc9000640f038 CR3: 000000014429c006 CR4: 00000000003706e0\n[  481.220530] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[  481.228771] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\n[  481.237029] Call Trace:\n[  481.239856]  rtnl_fill_ifinfo+0x768/0x12e0\n[  481.244602]  rtnl_dump_ifinfo+0x525/0x650\n[  481.249246]  ? __alloc_skb+0xa5/0x280\n[  481.253484]  netlink_dump+0x168/0x3c0\n[  481.257725]  netlink_recvmsg+0x21e/0x3e0\n[  481.262263]  ____sys_recvmsg+0x87/0x170\n[  481.266707]  ? __might_fault+0x20/0x30\n[  481.271046]  ? _copy_from_user+0x66/0xa0\n[  481.275591]  ? iovec_from_user+0xf6/0x1c0\n[  481.280226]  ___sys_recvmsg+0x82/0x100\n[  481.284566]  ? sock_sendmsg+0x5e/0x60\n[  481.288791]  ? __sys_sendto+0xee/0x150\n[  481.293129]  __sys_recvmsg+0x56/0xa0\n[  481.297267]  do_syscall_64+0x3b/0xc0\n[  481.301395]  entry_SYSCALL_64_after_hwframe+0x44/0xae\n[  481.307238] RIP: 0033:0x7f5466f39617\n[  481.311373] Code: 0c 00 f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb bd 0f 1f 00 f3 0f 1e fa 64 8b 04 25 18 00 00 00 85 c0 75 10 b8 2f 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 51 c3 48 83 ec 28 89 54 24 1c 48 89 74 24 10\n[  481.342944] RSP: 002b:00007ffedc7f4308 EFLAGS: 00000246 ORIG_RAX: 000000000000002f\n[  481.361783] RAX: ffffffffffffffda RBX: 00007ffedc7f5460 RCX: 00007f5466f39617\n[  481.380278] RDX: 0000000000000000 RSI: 00007ffedc7f5360 RDI: 0000000000000003\n[  481.398500] RBP: 00007ffedc7f53f0 R08: 0000000000000000 R09: 000055d556f04d50\n[  481.416463] R10: 0000000000000077 R11: 0000000000000246 R12: 00007ffedc7f5360\n[  481.434131] R13: 00007ffedc7f5350 R14: 00007ffedc7f5344 R15: 0000000000000e98\n[  481.451520] Modules linked in: ice\n---truncated--- \n            \n            MITIGATION: null",
		"advisory": {
			"from": "secalert@redhat.com",
			"severity": "Moderate",
			"updated": {
				"date": "2024-05-27"
			},
			"cve": [
				{
					"text": "CVE-2021-47563",
					"cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
					"href": "https://access.redhat.com/security/cve/CVE-2021-47563",
					"impact": "moderate",
					"public": "20240524"
				}
			],
			"affected": {
				"resolution": [
					{
						"state": "Out of support scope",
						"component": [
							"bpftool",
							"kernel",
							"kernel-abi-whitelists",
							"kernel-bootwrapper",
							"kernel-debug",
							"kernel-debug-devel",
							"kernel-devel",
							"kernel-doc",
							"kernel-headers",
							"kernel-kdump",
							"kernel-kdump-devel",
							"kernel-rt",
							"kernel-rt-debug",
							"kernel-rt-debug-devel",
							"kernel-rt-debug-kvm",
							"kernel-rt-devel",
							"kernel-rt-doc",
							"kernel-rt-kvm",
							"kernel-rt-trace",
							"kernel-rt-trace-devel",
							"kernel-rt-trace-kvm",
							"kernel-tools",
							"kernel-tools-libs",
							"kernel-tools-libs-devel",
							"perf",
							"python-perf"
						]
					}
				]
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/a:redhat:rhel_extras:7",
					"cpe:/a:redhat:rhel_extras_oracle_java:7",
					"cpe:/a:redhat:rhel_extras_rt:7",
					"cpe:/a:redhat:rhel_extras_sap:7",
					"cpe:/a:redhat:rhel_extras_sap_hana:7",
					"cpe:/o:redhat:enterprise_linux:7",
					"cpe:/o:redhat:enterprise_linux:7::client",
					"cpe:/o:redhat:enterprise_linux:7::computenode",
					"cpe:/o:redhat:enterprise_linux:7::server",
					"cpe:/o:redhat:enterprise_linux:7::workstation"
				]
			},
			"issued": {}
		},
		"affected": {}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterias": [
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446031",
										"comment": "kernel-rt-trace-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446032",
										"comment": "kernel-rt-trace-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542011",
										"comment": "perf is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542012",
										"comment": "perf is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446021",
										"comment": "kernel-rt-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446022",
										"comment": "kernel-rt-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542029",
										"comment": "kernel-tools-libs is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542030",
										"comment": "kernel-tools-libs is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542025",
										"comment": "kernel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542026",
										"comment": "kernel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446045",
										"comment": "kernel-rt-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446046",
										"comment": "kernel-rt-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542009",
										"comment": "bpftool is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542010",
										"comment": "bpftool is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446027",
										"comment": "kernel-rt is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446028",
										"comment": "kernel-rt is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542031",
										"comment": "kernel-headers is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542032",
										"comment": "kernel-headers is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446043",
										"comment": "kernel-rt-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446044",
										"comment": "kernel-rt-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542003",
										"comment": "kernel-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542004",
										"comment": "kernel-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542019",
										"comment": "kernel-kdump-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542020",
										"comment": "kernel-kdump-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542013",
										"comment": "kernel-bootwrapper is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542014",
										"comment": "kernel-bootwrapper is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542005",
										"comment": "kernel-doc is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542006",
										"comment": "kernel-doc is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542001",
										"comment": "kernel-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542002",
										"comment": "kernel-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542023",
										"comment": "kernel-abi-whitelists is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542024",
										"comment": "kernel-abi-whitelists is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446015",
										"comment": "kernel-rt-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446016",
										"comment": "kernel-rt-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446009",
										"comment": "kernel-rt-debug-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446010",
										"comment": "kernel-rt-debug-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542021",
										"comment": "python-perf is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542022",
										"comment": "python-perf is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542007",
										"comment": "kernel-kdump is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542008",
										"comment": "kernel-kdump is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446001",
										"comment": "kernel-rt-doc is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446002",
										"comment": "kernel-rt-doc is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542017",
										"comment": "kernel-tools-libs-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542018",
										"comment": "kernel-tools-libs-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446017",
										"comment": "kernel-rt-trace-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446018",
										"comment": "kernel-rt-trace-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542015",
										"comment": "kernel-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542016",
										"comment": "kernel-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446051",
										"comment": "kernel-rt-trace is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446052",
										"comment": "kernel-rt-trace is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542027",
										"comment": "kernel-tools is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542028",
										"comment": "kernel-tools is signed with Red Hat redhatrelease2 key"
									}
								]
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:com.redhat.cve:tst:20042779005",
						"comment": "Red Hat Enterprise Linux 7 is installed"
					}
				]
			}
		],
		"criterions": [
			{
				"test_ref": "oval:com.redhat.cve:tst:20042779006",
				"comment": "Red Hat Enterprise Linux must be installed"
			}
		]
	}
}
