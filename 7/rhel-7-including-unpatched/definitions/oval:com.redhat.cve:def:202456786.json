{
	"id": "oval:com.redhat.cve:def:202456786",
	"version": "636",
	"class": "vulnerability",
	"metadata": {
		"title": "kernel: bpf: put bpf_link's program when link is safe to be deallocated (low)",
		"reference": [
			{
				"ref_id": "CVE-2024-56786",
				"ref_url": "https://access.redhat.com/security/cve/CVE-2024-56786",
				"source": "CVE"
			}
		],
		"description": "DOCUMENTATION: The CVE program describes this issue as: In the Linux kernel, the following vulnerability has been resolved:\n\nbpf: put bpf_link's program when link is safe to be deallocated\n\nIn general, BPF link's underlying BPF program should be considered to be\nreachable through attach hook -> link -> prog chain, and, pessimistically,\nwe have to assume that as long as link's memory is not safe to free,\nattach hook's code might hold a pointer to BPF program and use it.\n\nAs such, it's not (generally) correct to put link's program early before\nwaiting for RCU GPs to go through. More eager bpf_prog_put() that we\ncurrently do is mostly correct due to BPF program's release code doing\nsimilar RCU GP waiting, but as will be shown in the following patches,\nBPF program can be non-sleepable (and, thus, reliant on only \"classic\"\nRCU GP), while BPF link's attach hook can have sleepable semantics and\nneeds to be protected by RCU Tasks Trace, and for such cases BPF link\nhas to go through RCU Tasks Trace + \"classic\" RCU GPs before being\ndeallocated. And so, if we put BPF program early, we might free BPF\nprogram before we free BPF link, leading to use-after-free situation.\n\nSo, this patch defers bpf_prog_put() until we are ready to perform\nbpf_link's deallocation. At worst, this delays BPF program freeing by\none extra RCU GP, but that seems completely acceptable. Alternatively,\nwe'd need more elaborate ways to determine BPF hook, BPF link, and BPF\nprogram lifetimes, and how they relate to each other, which seems like\nan unnecessary complication.\n\nNote, for most BPF links we still will perform eager bpf_prog_put() and\nlink dealloc, so for those BPF links there are no observable changes\nwhatsoever. Only BPF links that use deferred dealloc might notice\nslightly delayed freeing of BPF programs.\n\nAlso, to reduce code and logic duplication, extract program put + link\ndealloc logic into bpf_link_dealloc() helper.",
		"advisory": {
			"from": "secalert@redhat.com",
			"severity": "Low",
			"updated": {
				"date": "2025-01-09"
			},
			"cve": [
				{
					"text": "CVE-2024-56786",
					"cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
					"href": "https://access.redhat.com/security/cve/CVE-2024-56786",
					"impact": "low",
					"public": "20250108"
				}
			],
			"affected": {
				"resolution": [
					{
						"state": "Out of support scope",
						"component": [
							"bpftool",
							"kernel",
							"kernel-abi-whitelists",
							"kernel-bootwrapper",
							"kernel-debug",
							"kernel-debug-devel",
							"kernel-devel",
							"kernel-doc",
							"kernel-headers",
							"kernel-kdump",
							"kernel-kdump-devel",
							"kernel-rt",
							"kernel-rt-debug",
							"kernel-rt-debug-devel",
							"kernel-rt-debug-kvm",
							"kernel-rt-devel",
							"kernel-rt-doc",
							"kernel-rt-kvm",
							"kernel-rt-trace",
							"kernel-rt-trace-devel",
							"kernel-rt-trace-kvm",
							"kernel-tools",
							"kernel-tools-libs",
							"kernel-tools-libs-devel",
							"perf",
							"python-perf"
						]
					}
				]
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/a:redhat:rhel_extras:7",
					"cpe:/a:redhat:rhel_extras_oracle_java:7",
					"cpe:/a:redhat:rhel_extras_rt:7",
					"cpe:/a:redhat:rhel_extras_sap:7",
					"cpe:/a:redhat:rhel_extras_sap_hana:7",
					"cpe:/o:redhat:enterprise_linux:7",
					"cpe:/o:redhat:enterprise_linux:7::client",
					"cpe:/o:redhat:enterprise_linux:7::computenode",
					"cpe:/o:redhat:enterprise_linux:7::server",
					"cpe:/o:redhat:enterprise_linux:7::workstation"
				]
			},
			"issued": {}
		},
		"affected": {}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterias": [
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446051",
										"comment": "kernel-rt-trace is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446052",
										"comment": "kernel-rt-trace is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542007",
										"comment": "kernel-kdump is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542008",
										"comment": "kernel-kdump is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446001",
										"comment": "kernel-rt-doc is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446002",
										"comment": "kernel-rt-doc is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446027",
										"comment": "kernel-rt is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446028",
										"comment": "kernel-rt is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542013",
										"comment": "kernel-bootwrapper is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542014",
										"comment": "kernel-bootwrapper is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542015",
										"comment": "kernel-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542016",
										"comment": "kernel-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542001",
										"comment": "kernel-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542002",
										"comment": "kernel-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446043",
										"comment": "kernel-rt-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446044",
										"comment": "kernel-rt-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542027",
										"comment": "kernel-tools is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542028",
										"comment": "kernel-tools is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542017",
										"comment": "kernel-tools-libs-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542018",
										"comment": "kernel-tools-libs-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542021",
										"comment": "python-perf is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542022",
										"comment": "python-perf is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446009",
										"comment": "kernel-rt-debug-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446010",
										"comment": "kernel-rt-debug-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542005",
										"comment": "kernel-doc is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542006",
										"comment": "kernel-doc is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542019",
										"comment": "kernel-kdump-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542020",
										"comment": "kernel-kdump-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446045",
										"comment": "kernel-rt-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446046",
										"comment": "kernel-rt-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542029",
										"comment": "kernel-tools-libs is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542030",
										"comment": "kernel-tools-libs is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446021",
										"comment": "kernel-rt-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446022",
										"comment": "kernel-rt-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542011",
										"comment": "perf is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542012",
										"comment": "perf is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542023",
										"comment": "kernel-abi-whitelists is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542024",
										"comment": "kernel-abi-whitelists is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446015",
										"comment": "kernel-rt-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446016",
										"comment": "kernel-rt-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542025",
										"comment": "kernel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542026",
										"comment": "kernel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542031",
										"comment": "kernel-headers is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542032",
										"comment": "kernel-headers is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542003",
										"comment": "kernel-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542004",
										"comment": "kernel-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542009",
										"comment": "bpftool is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20124542010",
										"comment": "bpftool is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446017",
										"comment": "kernel-rt-trace-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446018",
										"comment": "kernel-rt-trace-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446031",
										"comment": "kernel-rt-trace-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:20137446032",
										"comment": "kernel-rt-trace-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:com.redhat.cve:tst:20042779005",
						"comment": "Red Hat Enterprise Linux 7 is installed"
					}
				]
			}
		],
		"criterions": [
			{
				"test_ref": "oval:com.redhat.cve:tst:20042779006",
				"comment": "Red Hat Enterprise Linux must be installed"
			}
		]
	}
}
