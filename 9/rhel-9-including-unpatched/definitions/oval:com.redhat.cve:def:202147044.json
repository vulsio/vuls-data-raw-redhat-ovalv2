{
	"id": "oval:com.redhat.cve:def:202147044",
	"version": "636",
	"class": "vulnerability",
	"metadata": {
		"title": "kernel: sched/fair: Fix shift-out-of-bounds in load_balance() (moderate)",
		"reference": [
			{
				"ref_id": "CVE-2021-47044",
				"ref_url": "https://access.redhat.com/security/cve/CVE-2021-47044",
				"source": "CVE"
			}
		],
		"description": "DOCUMENTATION: The MITRE CVE dictionary describes this issue as: In the Linux kernel, the following vulnerability has been resolved:\n\nsched/fair: Fix shift-out-of-bounds in load_balance()\n\nSyzbot reported a handful of occurrences where an sd->nr_balance_failed can\ngrow to much higher values than one would expect.\n\nA successful load_balance() resets it to 0; a failed one increments\nit. Once it gets to sd->cache_nice_tries + 3, this *should* trigger an\nactive balance, which will either set it to sd->cache_nice_tries+1 or reset\nit to 0. However, in case the to-be-active-balanced task is not allowed to\nrun on env->dst_cpu, then the increment is done without any further\nmodification.\n\nThis could then be repeated ad nauseam, and would explain the absurdly high\nvalues reported by syzbot (86, 149). VincentG noted there is value in\nletting sd->cache_nice_tries grow, so the shift itself should be\nfixed. That means preventing:\n\n  \"\"\"\n  If the value of the right operand is negative or is greater than or equal\n  to the width of the promoted left operand, the behavior is undefined.\n  \"\"\"\n\nThus we need to cap the shift exponent to\n  BITS_PER_TYPE(typeof(lefthand)) - 1.\n\nI had a look around for other similar cases via coccinelle:\n\n  @expr@\n  position pos;\n  expression E1;\n  expression E2;\n  @@\n  (\n  E1 >> E2@pos\n  |\n  E1 >> E2@pos\n  )\n\n  @cst depends on expr@\n  position pos;\n  expression expr.E1;\n  constant cst;\n  @@\n  (\n  E1 >> cst@pos\n  |\n  E1 << cst@pos\n  )\n\n  @script:python depends on !cst@\n  pos << expr.pos;\n  exp << expr.E2;\n  @@\n  # Dirty hack to ignore constexpr\n  if exp.upper() != exp:\n     coccilib.report.print_report(pos[0], \"Possible UB shift here\")\n\nThe only other match in kernel/sched is rq_clock_thermal() which employs\nsched_thermal_decay_shift, and that exponent is already capped to 10, so\nthat one is fine.",
		"advisory": {
			"from": "secalert@redhat.com",
			"severity": "Moderate",
			"updated": {
				"date": "2024-04-16"
			},
			"cve": [
				{
					"text": "CVE-2021-47044",
					"cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
					"cwe": "CWE-125",
					"href": "https://access.redhat.com/security/cve/CVE-2021-47044",
					"impact": "moderate",
					"public": "20240228"
				}
			],
			"affected": {
				"resolution": [
					{
						"state": "Affected",
						"component": [
							"kernel-rt",
							"kernel-rt-core",
							"kernel-rt-debug",
							"kernel-rt-debug-core",
							"kernel-rt-debug-devel",
							"kernel-rt-debug-devel-matched",
							"kernel-rt-debug-kvm",
							"kernel-rt-debug-modules",
							"kernel-rt-debug-modules-core",
							"kernel-rt-debug-modules-extra",
							"kernel-rt-debug-modules-internal",
							"kernel-rt-debug-modules-partner",
							"kernel-rt-devel",
							"kernel-rt-devel-matched",
							"kernel-rt-kvm",
							"kernel-rt-modules",
							"kernel-rt-modules-core",
							"kernel-rt-modules-extra",
							"kernel-rt-modules-internal",
							"kernel-rt-modules-partner",
							"kernel-rt-selftests-internal"
						]
					}
				]
			},
			"affected_cpe_list": {
				"cpe": [
					"cpe:/a:redhat:enterprise_linux:9",
					"cpe:/a:redhat:enterprise_linux:9::appstream",
					"cpe:/a:redhat:enterprise_linux:9::crb",
					"cpe:/a:redhat:enterprise_linux:9::highavailability",
					"cpe:/a:redhat:enterprise_linux:9::nfv",
					"cpe:/a:redhat:enterprise_linux:9::realtime",
					"cpe:/a:redhat:enterprise_linux:9::resilientstorage",
					"cpe:/a:redhat:enterprise_linux:9::sap",
					"cpe:/a:redhat:enterprise_linux:9::sap_hana",
					"cpe:/a:redhat:enterprise_linux:9::supplementary",
					"cpe:/o:redhat:enterprise_linux:9",
					"cpe:/o:redhat:enterprise_linux:9::baseos"
				]
			},
			"issued": {}
		},
		"affected": {}
	},
	"criteria": {
		"operator": "OR",
		"criterias": [
			{
				"operator": "AND",
				"criterias": [
					{
						"operator": "OR",
						"criterias": [
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160015",
										"comment": "kernel-rt-debug-modules-partner is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160016",
										"comment": "kernel-rt-debug-modules-partner is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160057",
										"comment": "kernel-rt-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160058",
										"comment": "kernel-rt-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160067",
										"comment": "kernel-rt-modules-extra is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160068",
										"comment": "kernel-rt-modules-extra is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160119",
										"comment": "kernel-rt is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160120",
										"comment": "kernel-rt is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160085",
										"comment": "kernel-rt-debug-devel-matched is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160086",
										"comment": "kernel-rt-debug-devel-matched is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160065",
										"comment": "kernel-rt-debug-modules-extra is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160066",
										"comment": "kernel-rt-debug-modules-extra is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160063",
										"comment": "kernel-rt-debug-modules-core is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160064",
										"comment": "kernel-rt-debug-modules-core is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160117",
										"comment": "kernel-rt-debug-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160118",
										"comment": "kernel-rt-debug-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160011",
										"comment": "kernel-rt-debug-modules-internal is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160012",
										"comment": "kernel-rt-debug-modules-internal is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160023",
										"comment": "kernel-rt-debug-kvm is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160024",
										"comment": "kernel-rt-debug-kvm is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160121",
										"comment": "kernel-rt-modules-core is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160122",
										"comment": "kernel-rt-modules-core is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160125",
										"comment": "kernel-rt-modules-internal is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160126",
										"comment": "kernel-rt-modules-internal is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160047",
										"comment": "kernel-rt-modules-partner is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160048",
										"comment": "kernel-rt-modules-partner is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160165",
										"comment": "kernel-rt-debug-core is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160166",
										"comment": "kernel-rt-debug-core is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160115",
										"comment": "kernel-rt-devel-matched is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160116",
										"comment": "kernel-rt-devel-matched is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160109",
										"comment": "kernel-rt-debug is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160110",
										"comment": "kernel-rt-debug is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160001",
										"comment": "kernel-rt-modules is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160002",
										"comment": "kernel-rt-modules is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160081",
										"comment": "kernel-rt-core is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160082",
										"comment": "kernel-rt-core is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160039",
										"comment": "kernel-rt-debug-modules is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160040",
										"comment": "kernel-rt-debug-modules is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160111",
										"comment": "kernel-rt-selftests-internal is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160112",
										"comment": "kernel-rt-selftests-internal is signed with Red Hat redhatrelease2 key"
									}
								]
							},
							{
								"operator": "AND",
								"criterions": [
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160077",
										"comment": "kernel-rt-devel is installed"
									},
									{
										"test_ref": "oval:com.redhat.cve:tst:201925160078",
										"comment": "kernel-rt-devel is signed with Red Hat redhatrelease2 key"
									}
								]
							}
						]
					}
				],
				"criterions": [
					{
						"test_ref": "oval:com.redhat.cve:tst:20052541003",
						"comment": "Red Hat Enterprise Linux 9 is installed"
					}
				]
			}
		],
		"criterions": [
			{
				"test_ref": "oval:com.redhat.cve:tst:20052541004",
				"comment": "Red Hat Enterprise Linux must be installed"
			}
		]
	}
}
